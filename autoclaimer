--[[ 
    ADVANCED BOOTH SEARCHER & CLAIMER
    - Locates 'BoothModels' > 'BasicBooth'
    - Teleports & Simulates 'E' Hold
    - Scans Console for "YourBooth" validation
    - Draggable UI + Toggle (RightCtrl)
]]

local Players = game:GetService("Players")
local Workspace = game:GetService("Workspace")
local LogService = game:GetService("LogService")
local RunService = game:GetService("RunService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")

local LocalPlayer = Players.LocalPlayer
local PlayerGui = LocalPlayer:WaitForChild("PlayerGui")

-- Configuration
local SEARCH_DELAY = 4 -- 3s hold + 1s buffer
local UI_TOGGLE_KEY = Enum.KeyCode.RightControl

-- State
local isSearching = false
local boothFound = false
local currentLoop = nil

--------------------------------------------------------------------------------
-- GUI CREATION (Forced to PlayerGui for Safety)
--------------------------------------------------------------------------------

local ScreenGui = Instance.new("ScreenGui")
ScreenGui.Name = "BoothSearcherGUI"
ScreenGui.ResetOnSpawn = false
ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

-- Force Parent to PlayerGui to ensure it appears
ScreenGui.Parent = PlayerGui 

local MainFrame = Instance.new("Frame")
MainFrame.Name = "MainFrame"
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 35)
MainFrame.BorderSizePixel = 0
MainFrame.Position = UDim2.new(0.5, -150, 0.5, -100)
MainFrame.Size = UDim2.new(0, 300, 0, 200)
MainFrame.Parent = ScreenGui

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 8)
UICorner.Parent = MainFrame

local UIStroke = Instance.new("UIStroke")
UIStroke.Color = Color3.fromRGB(60, 60, 60)
UIStroke.Thickness = 2
UIStroke.Parent = MainFrame

-- Title
local Title = Instance.new("TextLabel")
Title.BackgroundTransparency = 1
Title.Size = UDim2.new(1, 0, 0, 40)
Title.Font = Enum.Font.GothamBold
Title.Text = "BOOTH SEARCHER"
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 18
Title.Parent = MainFrame

-- Status
local StatusLabel = Instance.new("TextLabel")
StatusLabel.BackgroundTransparency = 1
StatusLabel.Position = UDim2.new(0, 0, 0.3, 0)
StatusLabel.Size = UDim2.new(1, 0, 0, 20)
StatusLabel.Font = Enum.Font.Gotham
StatusLabel.Text = "Status: Idle"
StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
StatusLabel.TextSize = 14
StatusLabel.Parent = MainFrame

-- Toggle Button
local StartBtn = Instance.new("TextButton")
StartBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 100)
StartBtn.Position = UDim2.new(0.1, 0, 0.55, 0)
StartBtn.Size = UDim2.new(0.8, 0, 0, 40)
StartBtn.Font = Enum.Font.GothamBold
StartBtn.Text = "START SEARCH"
StartBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
StartBtn.TextSize = 16
StartBtn.Parent = MainFrame

local BtnCorner = Instance.new("UICorner")
BtnCorner.CornerRadius = UDim.new(0, 6)
BtnCorner.Parent = StartBtn

-- Helper Text
local Helper = Instance.new("TextLabel")
Helper.BackgroundTransparency = 1
Helper.Position = UDim2.new(0, 0, 0.85, 0)
Helper.Size = UDim2.new(1, 0, 0, 20)
Helper.Text = "Logs check for 'YourBooth'"
Helper.TextColor3 = Color3.fromRGB(100, 100, 100)
Helper.Font = Enum.Font.Gotham
Helper.TextSize = 11
Helper.Parent = MainFrame

--------------------------------------------------------------------------------
-- DRAGGABLE LOGIC
--------------------------------------------------------------------------------
local dragging, dragInput, dragStart, startPos
local function update(input)
    local delta = input.Position - dragStart
    MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
end
MainFrame.InputBegan:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
        dragging = true
        dragStart = input.Position
        startPos = MainFrame.Position
        input.Changed:Connect(function() if input.UserInputState == Enum.UserInputState.End then dragging = false end end)
    end
end)
MainFrame.InputChanged:Connect(function(input)
    if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then dragInput = input end
end)
UserInputService.InputChanged:Connect(function(input) if input == dragInput and dragging then update(input) end end)

--------------------------------------------------------------------------------
-- LOGIC
--------------------------------------------------------------------------------

-- 1. Monitor Logs for "YourBooth"
LogService.MessageOut:Connect(function(message, messageType)
    if isSearching then
        if string.find(message, "YourBooth") then
            boothFound = true
            StatusLabel.Text = "Status: Booth Claimed!"
            StatusLabel.TextColor3 = Color3.fromRGB(0, 255, 150)
            StartBtn.Text = "CLAIMED"
            isSearching = false -- Stop the loop
        end
    end
end)

local function getBooths()
    local folder = Workspace:FindFirstChild("BoothModels")
    if not folder then return {} end
    
    local booths = {}
    for _, v in pairs(folder:GetChildren()) do
        if v.Name == "BasicBooth" then
            table.insert(booths, v)
        end
    end
    return booths
end

local function interactWithBooth(model)
    -- Find ProximityPrompt inside the model
    local prompt = model:FindFirstChildWhichIsA("ProximityPrompt", true)
    
    if prompt then
        -- Attempt to fire it automatically (Executor only)
        if fireproximityprompt then
            fireproximityprompt(prompt)
        else
            -- Standard Client: We can't force the server to accept the input 
            -- without hardware interaction, but we simulate the hold logic.
            -- This moves the prompt UI to the 'held' state visually.
            prompt:InputHoldBegin()
            task.wait(prompt.HoldDuration or 3)
            prompt:InputHoldEnd()
        end
    end
end

local function stopSearch()
    isSearching = false
    boothFound = false
    StatusLabel.Text = "Status: Idle"
    StatusLabel.TextColor3 = Color3.fromRGB(200, 200, 200)
    StartBtn.Text = "START SEARCH"
    StartBtn.BackgroundColor3 = Color3.fromRGB(0, 170, 100)
end

local function startSearch()
    if isSearching then stopSearch() return end
    
    local booths = getBooths()
    if #booths == 0 then
        StatusLabel.Text = "Error: No Booths Found"
        StatusLabel.TextColor3 = Color3.fromRGB(255, 50, 50)
        return
    end

    isSearching = true
    boothFound = false
    StartBtn.Text = "STOP SEARCH"
    StartBtn.BackgroundColor3 = Color3.fromRGB(170, 50, 50)
    StatusLabel.TextColor3 = Color3.fromRGB(255, 200, 50)

    task.spawn(function()
        while isSearching and not boothFound do
            -- 1. Pick Random Booth
            local randomBooth = booths[math.random(1, #booths)]
            StatusLabel.Text = "Status: Checking Booth..."

            -- 2. Teleport
            local char = LocalPlayer.Character
            if char and char:FindFirstChild("HumanoidRootPart") and randomBooth.PrimaryPart then
                -- Move slightly in front of the booth
                char.HumanoidRootPart.CFrame = randomBooth.PrimaryPart.CFrame * CFrame.new(0, 0, -4)
                char.HumanoidRootPart.Velocity = Vector3.new(0,0,0) -- Stop sliding
            end

            task.wait(0.5) -- Stabilize

            -- 3. Interact (Hold E)
            interactWithBooth(randomBooth)

            -- 4. Wait for Log Detection (Hold Time + Buffer)
            task.wait(SEARCH_DELAY)

            -- 5. Check Result
            if boothFound then
                break -- Exit loop, we found it
            end
            
            -- Prepare for next cycle
            task.wait(0.5)
        end
    end)
end

StartBtn.MouseButton1Click:Connect(startSearch)

-- Toggle Keybind
UserInputService.InputBegan:Connect(function(input)
    if input.KeyCode == UI_TOGGLE_KEY then
        MainFrame.Visible = not MainFrame.Visible
    end
end)
